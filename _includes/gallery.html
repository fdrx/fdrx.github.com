<!-- GALLERY -->
{% assign image_list = include.images | split: "," %}
{% assign center_class = '' %}
{% if include.center and image_list.size == 1 %}
  {% assign center_class = 'centered' %}
{% endif %}
<ul class="gallery {{ center_class }}">
  {% assign title_list = include.titles | split: "," %}
  {% assign link_list = include.links | split: "," %}
  {% assign base_path = include.path | default: 'maps_path' %}
  {% assign folder_part = include.folder | default: '' | remove: '/' %}
  {% assign folder = site[base_path] | append: '/' | append: folder_part | replace: '//', '/' | replace: '//', '/' | replace: '//', '/' %}
  {% if folder_part != '' %}{% assign folder = folder | append: '/' %}{% endif %}
  {% assign thumbs_folder_part = include.thumbs_folder | default: folder_part | remove: '/' %}
  {% assign thumbs_folder = site.thumbs_path | append: '/' | append: thumbs_folder_part | replace: '//', '/' | replace: '//', '/' | replace: '//', '/' %}
  {% if thumbs_folder_part != '' %}{% assign thumbs_folder = thumbs_folder | append: '/' %}{% endif %}

  {% if image_list.size == title_list.size and (include.links == nil or image_list.size == link_list.size) %}
    {% for i in (0..image_list.size) offset:1 %}
      {% assign index = forloop.index0 %}
      {% assign link = link_list[index] | strip %}
      <li>
        <a href="{% if link != '' %}{{ link }}{% else %}#{% endif %}" {% if link == '' %}class="popup-trigger" data-popup="{{ folder }}{{ image_list[index] | strip }}"{% endif %} title="{{ title_list[index] | strip | replace: '<a', '' | replace: '</a>', '' | replace: 'href=\"', '' | replace: '\"', '' }}">
          <img src="{{ thumbs_folder }}{{ image_list[index] | strip }}" alt="{{ title_list[index] | strip | replace: '<a', '' | replace: '</a>', '' | replace: 'href=\"', '' | replace: '\"', '' }}" />
        </a>
        <div class="title">{{ title_list[index] | raw }}</div>
      </li>
    {% endfor %}
  {% else %}
    <p>Error: The number of images, titles, or links does not match.</p>
  {% endif %}
</ul>

<!-- POPUP HTML -->
<div id="image-popup" class="popup" style="display: none;">
  <div class="popup-content">
    <span class="popup-close">&times;</span>
    <img id="popup-image" src="" alt="Popup Image" />
  </div>
</div>

<!-- POPUP JS -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const triggers = document.querySelectorAll('.popup-trigger');
    const popup = document.getElementById('image-popup');
    const popupImage = document.getElementById('popup-image');
    const closeBtn = document.querySelector('.popup-close');

    triggers.forEach(trigger => {
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        const imgSrc = this.getAttribute('data-popup');
        popupImage.src = imgSrc;
        popup.style.display = 'flex';
      });
    });

    closeBtn.addEventListener('click', function() {
      popup.style.display = 'none';
      popupImage.src = '';
    });

    popup.addEventListener('click', function(e) {
      if (e.target === popup) {
        popup.style.display = 'none';
        popupImage.src = '';
      }
    });
  });
</script>